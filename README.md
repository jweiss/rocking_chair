Development has stopped as I don't use RockingChair anymore. Please expect no further development.


An in-memory CouchDB implementation in Ruby for [couchrest](http://github.com/jchris/couchrest) and [SimplyStored](http://github.com/peritor/simply_stored). 
Works for the database and document API, by_attribute views, and for SimplyStored generated views. 
This way your tests will no longer depend on CouchDB and can run against an in-memory database.

It intercepts the HTTP-API calls of couchrest by implementing a 
HTTPAdapter for [couchrest](http://github.com/jchris/couchrest). It then delegates those calls to the
in-memory database. 

The in-memory database a hash of document_id => JSON-object.

RockingChair support simple views like _all_docs_ or _by_attribute_.
Further, it should supports all the views generated by [SimplyStored](http://github.com/peritor/simply_stored).
So it supports associations and soft deletion.

Installation
============

    gem install rocking_chair

Usage
=============

Require the gem in your tests, e.g. test_helper.rb in Rails:

    require 'rocking_chair'
    
Then activate it:

    RockingChair.enable
    
Make sure to reset it every now and then so that your testdata doesn't grow too much.
Put this e.g. in your setup block:

    def setup
      RockingChair::Server.reset
    end
   
If you have tests where you want to run against the real CouchDB, 
just deactivate RockingChair:

    RockingChair.disable

You can also make RockingChair dump all requests:

    RockingChair.enable_debug
    
and

    RockingChair.disable_debug
    
    
Caveats
=============

At the moment the performance is not as good as it could be as there is a lot of serialization to and from JSON going on.
This will be improved by storing not only the JSON tree but also the Ruby representation of the stored objects.

License
=============

RockingChair is licensed under the Apache 2.0 license. See LICENSE.txt

About
=============

RockingChair was written by [Jonathan Weiss](http://twitter.com/jweiss) to make [Mathias Meyer](http://twitter.com/roidrage) happy.

